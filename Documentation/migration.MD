# ðŸ”„ Guide de migration vers la nouvelle structure

Ce document explique comment migrer depuis votre ancien fichier unique vers la nouvelle structure modulaire.

## ðŸ“‹ Checklist de migration

### âœ… Ã‰tape 1 : Sauvegarde
- [ ] Faire une copie de votre fichier R original
- [ ] Commiter vos changements actuels sur Git

### âœ… Ã‰tape 2 : Structure des dossiers

CrÃ©er la structure suivante :

```bash
Challenge_Open_Data/
â”œâ”€â”€ ui/
â”œâ”€â”€ server/
â”œâ”€â”€ www/
â””â”€â”€ data/
```

Commandes :
```bash
mkdir ui server www data
```

### âœ… Ã‰tape 3 : DÃ©placement des fichiers

1. **Copier les nouveaux fichiers** :
   ```
   global.R          â†’ racine/
   ui.R              â†’ racine/
   server.R          â†’ racine/
   
   ui/*.R            â†’ ui/
   server/*.R        â†’ server/
   
   custom.css        â†’ www/
   ```

2. **DÃ©placer vos donnÃ©es** :
   ```
   Vos fichiers .csv, .rds, .json  â†’ data/
   ```

### âœ… Ã‰tape 4 : VÃ©rification des chemins

Dans `global.R`, vÃ©rifier que les chemins de chargement pointent vers `data/` :

```R
# Exemple pour FINESS
finess_data <- read.csv(
  file.path(chemin_base, "data/finess_geolocalise.csv"),
  # ...
)
```

### âœ… Ã‰tape 5 : Test de l'application

```R
# Depuis RStudio
shiny::runApp()
```

VÃ©rifier que :
- [ ] Toutes les pages se chargent
- [ ] Les donnÃ©es s'affichent correctement
- [ ] Les filtres fonctionnent
- [ ] Les graphiques s'affichent
- [ ] Les cartes fonctionnent
- [ ] Les tÃ©lÃ©chargements CSV fonctionnent

---

## ðŸ› RÃ©solution des problÃ¨mes courants

### ProblÃ¨me : "Fichier non trouvÃ©"

**Cause** : Chemin incorrect vers les donnÃ©es

**Solution** :
```R
# Dans global.R, vÃ©rifier la variable chemin_base
print(chemin_base)
print(getwd())

# VÃ©rifier l'existence des fichiers
list.files("data/")
```

### ProblÃ¨me : "Fonction non trouvÃ©e"

**Cause** : BibliothÃ¨que non chargÃ©e

**Solution** :
```R
# VÃ©rifier dans global.R que toutes les bibliothÃ¨ques sont chargÃ©es
library(shiny)
library(shinydashboard)
# etc...
```

### ProblÃ¨me : CSS ne s'applique pas

**Cause** : Fichier CSS non chargÃ© ou mauvais chemin

**Solution** :
```R
# Dans ui.R, vÃ©rifier :
tags$head(tags$link(rel = "stylesheet", type = "text/css", href = "custom.css"))

# VÃ©rifier que custom.css est bien dans www/
list.files("www/")
```

### ProblÃ¨me : Erreur au dÃ©marrage

**Cause** : Erreur de syntaxe dans un module

**Solution** :
```R
# Tester chaque module individuellement
source("ui/ui_accueil.R")
source("server/server_finess.R")
# etc...
```

---

## ðŸŽ¯ DiffÃ©rences principales

### Avant (fichier unique)
```R
# Tout dans app.R
library(shiny)
# ... 3500 lignes de code ...
shinyApp(ui, server)
```

### AprÃ¨s (structure modulaire)
```R
# global.R - Configuration
# ui.R - Structure UI
# server.R - Orchestration serveur
# ui/*.R - Modules UI
# server/*.R - Modules serveur
# www/custom.css - Styles
```

### Avantages de la nouvelle structure

1. **Maintenance** : Plus facile de trouver et corriger du code
2. **Collaboration** : Plusieurs personnes peuvent travailler en parallÃ¨le
3. **LisibilitÃ©** : Code mieux organisÃ© et commentÃ©
4. **Performance** : Chargement plus rapide en production
5. **Ã‰volution** : Ajout de nouvelles fonctionnalitÃ©s simplifiÃ©

---

## ðŸ“¦ DÃ©ploiement

### DÃ©ploiement local

```R
# Depuis la racine du projet
shiny::runApp(port = 3838)
```

### DÃ©ploiement sur shinyapps.io

```R
library(rsconnect)

# PremiÃ¨re fois : configurer le compte
rsconnect::setAccountInfo(
  name = "votre-nom",
  token = "votre-token",
  secret = "votre-secret"
)

# DÃ©ployer l'application
rsconnect::deployApp(
  appDir = ".",
  appName = "sante-territoires"
)
```

### DÃ©ploiement sur Shiny Server

1. Copier tout le projet dans `/srv/shiny-server/sante-territoires/`
2. S'assurer que le dossier `data/` est accessible
3. VÃ©rifier les permissions :
   ```bash
   sudo chown -R shiny:shiny /srv/shiny-server/sante-territoires
   ```
4. RedÃ©marrer le serveur :
   ```bash
   sudo systemctl restart shiny-server
   ```

---

## ðŸ”§ Personnalisation

### Ajouter une nouvelle page

1. **CrÃ©er le module UI** :
   ```R
   # ui/ui_nouvelle_page.R
   tabItem(
     tabName = "nouvelle_page",
     fluidRow(
       # Votre contenu
     )
   )
   ```

2. **Ajouter dans ui.R** :
   ```R
   source("ui/ui_nouvelle_page.R", local = TRUE)$value
   ```

3. **CrÃ©er la logique serveur** :
   ```R
   # server/server_nouvelle_page.R
   output$mon_output <- renderPlot({
     # Votre logique
   })
   ```

4. **Ajouter dans server.R** :
   ```R
   source("server/server_nouvelle_page.R", local = TRUE)
   ```

5. **Ajouter dans le menu** (ui.R, sidebar) :
   ```R
   menuItem("Nouvelle page", tabName = "nouvelle_page", icon = icon("star"))
   ```

### Modifier les couleurs

Ã‰diter `www/custom.css` :

```css
/* Changer les couleurs du gradient principal */
.main-header .logo {
  background: linear-gradient(135deg, #VOTRE_COULEUR1 0%, #VOTRE_COULEUR2 100%) !important;
}
```

### Ajouter une nouvelle bibliothÃ¨que

Dans `global.R` :
```R
# Section 1
library(nouvelle_bibliotheque)
```

---

## ðŸ“š Ressources

### Documentation Shiny
- [Shiny Documentation](https://shiny.rstudio.com/)
- [shinydashboard](https://rstudio.github.io/shinydashboard/)

### Tutoriels
- [Shiny Modules](https://shiny.rstudio.com/articles/modules.html)
- [Leaflet for R](https://rstudio.github.io/leaflet/)
- [Plotly R](https://plotly.com/r/)

### CommunautÃ©
- [RStudio Community](https://community.rstudio.com/)
- [Stack Overflow - Shiny](https://stackoverflow.com/questions/tagged/shiny)

---

## âœ… Liste de vÃ©rification finale

Avant de dÃ©ployer en production :

- [ ] Tous les tests passent
- [ ] Les donnÃ©es sont Ã  jour
- [ ] Le fichier README.md est complet
- [ ] Le .gitignore est configurÃ©
- [ ] Les secrets sont sÃ©curisÃ©s (pas de tokens dans le code)
- [ ] Les performances sont acceptables (temps de chargement)
- [ ] L'application est responsive (fonctionne sur mobile)
- [ ] Les erreurs sont gÃ©rÃ©es gracieusement
- [ ] La documentation est Ã  jour

---

## ðŸŽ‰ FÃ©licitations !

Votre application est maintenant restructurÃ©e et prÃªte pour la production !

Pour toute question, n'hÃ©sitez pas Ã  :
- Consulter la documentation (README.md, STRUCTURE.md)
- Ouvrir une issue sur GitHub
- Contacter l'Ã©quipe de dÃ©veloppement

**Bonne chance avec votre Dashboard SantÃ© & Territoires ! ðŸ¥ðŸ“Š**